<% provide(:title, "Job Invitations") %>
<%= render 'users/index_sidebar' %>

<div class="col-md-8">
  <section class="user_info">
    <h4>Job Invitations</h4>

    <% if current_user.employer? %>
      <%= link_to 'Add New', new_invitation_path, class:"btn btn-default btn-sm" %>
      <br><br>
      <ul class="job_posts">
        <li>
          <table>
            <thead>
              <tr>
                <th>Job Name</th>
                <th>Freelancer</th>
                <th>Message</th>
                <th>Status</th>
                <th colspan="2">Action</th>
              </tr>
            </thead>

            <tbody>
              <% if @invitations.any? %>
                <% @invitations.each do |i| %>
                  <% if i.status == "accepted" || i.status == "completed" %>
                  <% else %>
                    <tr id="i-<%= i.id %>">
                      <td><%= i.job_post.name %></td>
                      <td><%= link_to i.recipient.name,
                              freelancer_profile_path(i.recipient.id) %></td>
                      <td><%= i.content %></td>
                      <td><%= i.status %></td>
                      <td><%= link_to 'Delete', delete_invitation_path(i.id),
                              data: { confirm: 'Are you sure you want to delete this invitation?' } %></td>
                    </tr>
                  <% end %>
                <% end %>
              <% else %>
                <tr><td colspan="5">There are currently no job invitations</td></tr>
              <% end %>
            </tbody>
          </table>
        </li>
      </ul>

    <% else %>

      <br>
      <ul class="job_posts">
        <li>
          <table>
            <thead>
              <tr>
                <th>Job Name</th>
                <th>Employer</th>
                <th>Message</th>
                <th>Status</th>
                <th colspan="2">Action</th>
              </tr>
            </thead>
            <tbody>
            <% if @invites.any? %>
              <% @invites.each do |i| %>
                <% if i.status == "accepted" || i.status == "completed" %>
                <% else %>
                  <tr id="i-<%= i.id %>">
                    <td><%= i.job_post.name %></td>
                    <td><%= link_to i.sender.name,
                            employer_profile_path(i.sender.id) %></td>
                    <td><%= i.content %></td>
                    <td><%= i.status %></td>
                    <td><%= link_to 'Accept', accept_invitation_path(i.id),
                                    data: { confirm: 'Are you sure you want to accept this job?' }%></td>
                    <td><%= link_to 'Decline', decline_invitation_path(i.id),
                                    data: { confirm: 'Are you sure you want to decline this job?' }%></td>
                  </tr>
                <% end %>
              <% end %>
            <% else %>
              <tr><td colspan="5">There are currently no job invitations</td></tr>
            <% end %>
            </tbody>
          </table>
        </li>
      </ul>
    <% end %>

  </section>
</div>
